% Copyright (c) 2015 Benito Palacios Sánchez - All Rights Reserved.
% Esta obra está licenciada bajo la Licencia Creative Commons Atribución 4.0
% Internacional. Para ver una copia de esta licencia, visita
% http://creativecommons.org/licenses/by/4.0/.

\chapter{Contenido con derechos de autor}
\label{sec:copyright}
% DRM -> Tipos DRM -> Agujero analógico -> Mi análisis.
La gestión de los derechos de autor ha generado un debate que sigue sin estar resuelto entre la libertad del usuario, y la protección del creador de la obra~\cite{EurAct-CPR}.
Esta industria incluye a los videojuegos, donde la piratería causa pérdidas millonarias\cite{DRM-Game-Carolina}.
De este contexto nace la idea del \ac{DRM}, un mecanismo para imposibilitar la distribución no autorizada de contenido.

Las características de estas técnicas se resumen en detectar quién accede a cada obra, cuándo y bajo qué condiciones, autorizar o denegar de manera inapelable el acceso y autorizarlo bajo condiciones restrictivas~\cite{Wiki-DRM}.
En cuanto a mecanismos que se aplican para evitar la distribución ilegítima, los más comunes son~\cite{DRM-Game-Carolina}:

\begin{itemize}
\item Claves en CD.
Se imprimían en la superficie del CD una clave que se pedía durante la instalación.
La parte negativa es que si se perdía esta clave, el usuario legítimo no podía acceder y, que con una simple búsqueda en Internet se podía obtener.

\item Límite de instalaciones.
Uno de los siguientes métodos fue controlar el número de instalaciones.
Para ello, el producto se tenía que activar realizando una conexión con los servidores de la compañía.
Sin embargo esto requiere que el usuario tenga acceso a Internet, y  que los servidores estén activos.
Además limita el número de dispositivos del usuario.

\item Conexión permanente (\textit{Always-on DRM}\cite{Wiki-AlwaysOn}).
Este método necesita una conexión en cada inicio del juego con los servidores de la compañía, e incluso en algunos casos, durante toda la partida.
Esto ha causado polémica debido a que el usuario no podría jugar sin conexión a Internet y, porque los servidores tienen que estar activos todo el tiempo~\footnote{Algunos juegos de la compañía \textit{Ubisoft} se quedaron sin acceso por tiempo indefinido debido a tareas de mantenimiento de los servidores. \url{http://www.gamespot.com/articles/ubisoft-drm-games-to-be-temporarily-unplayable/1100-6349732/}}.

\item Cifrado del \textit{software}.
Consiste en cifrar la aplicación usando claves asimétricas~\cite{iOS-Encryption}.
Como contrapartida, si el usuario pierde su clave privada y el acceso a ella, no podría volver a ejecutar ninguna aplicación.
\end{itemize}

El principal problema es la posibilidad de aplicar métodos de \emph{ingeniería inversa} sobre el \textit{software} autorizado.
Una vez comprendido cómo una aplicación autorizada accede al contenido protegido, se podría superar los mecanimos de protección para extraer y en algunos casos modificar el recurso.
De aquí vienen la necesidad de trabajar sobre entornos cerrados (capítulo~\ref{sec:art}) cada vez más frecuentes en videoconsolas y móviles\footnote{Los sistemas operativos iOS y Android no permiten el acceso al sistema de ficheros por defecto.}.
Una alternativa sería implementar el algoritmo en \textit{hardware} como es el caso de la \acl{N3DS}.

Aun encontrando un algoritmo eficiente en términos de protección y, sin sobrecarga a la hora de procesado, una vulnerabilidad inevitable es el denominado \textbf{\textit{agujero analógico}}.
La técnica consiste en reconvertir un medio digital en analógico, perdiendo los mecanismos DRM.
Por ejemplo, grabar música que se está reproduciendo con un micrófono, grabar con una cámara una pantalla, escanear un libro o incluso copiarlo a mano.
Estos procedimientos, se utilizan en los videojuegos para, mediante funciones del emulador como capturas de pantalla o grabación de audio, extraer y compartir recursos en páginas como \textit{Spriters Resource}\footnote{\url{http://www.spriters-resource.com/}}.

En las siguientes secciones se analizarán los posibles mecanismos de seguridad que los juegos aplicarían sobre contenido con derechos de autor.
Para ello se han escogido una serie de juegos conocidos por tener materiales, que frecuentemente son protegidos~\cite{SurveyDrm}.
En primer lugar se analizarán juegos con libros electrónicos, a continuación se investigará el género \textit{músical} y la protección sobre el material filmográfico.
El resultado en todos los casos ha sido la carencia de cualquier mecanismo a la hora de proteger los contenidos, exceptuando en el material en formato de vídeo descrito en la última sección.
También destaca la distribución de material adicional como el caso de un libro físico en \textit{Ninokuni} para \acl{NDS} o \textit{hardware} en la saga \textit{Guitar Hero: On Tour}.

\section{Libros electrónicos}
\subsection{Ninokuni y la Ira de la Bruja Blanca}
El primero juego a tratar será \textit{Ninokuni y La Ira de la Bruja Blanca} desarrollado por \textit{Level-5} para \textit{Play Station 3} en el año 2011.
Se trata de una versión muy similar a la que salió dos años antes para la \textit{Nintendo DS} que incluía un libro físico imprescindible para el jugador.

Debido a los problemas de traducción y distribución de este libro, ese juego no salió de Japón.
En el caso de esta versión para \acs{PS3} y aprovechando las capacidades de una pantalla grande el libro de tradujo y se incluyó en el juego pudiendo acceder a él mediante un visor especial accesible desde un menú.
En la edición coleccionista del juego si se daba una copia física en inglés.
El denominado \textit{Vademécum del mago} en la primera versión del juego nunca se llego a escanear siendo imposible de encontrarlo en Internet.
Al no encontrase disponible en Internet
En cambio, debido a una gran falta de seguridad en su distribución digital, en pocos días se pudo acceder a los archivos del juego y realizar una sencilla conversión a PDF.

El libro digital se encuentra codificado en el archivo \textit{hd05\_es.sdat} dentro de la carpeta principal en formato \emph{PSAR} (común en juegos de \acs{PS3}).
Se trata de un fichero que contiene archivos comprimidos.
La compresión en este caso fue obvia pues en la posición \textsf{0x08} se encuentra en ASCII la cadena de caracteres \textsf{zlib} (figura~\ref{fig:cr-psar}).
Además el fichero no presenta dificultad en su descifrado pues se basa como en la mayoría de su tipo en incluir después de la cabecera todas las posiciones y tamaños de los archivos que incluye (tabla~\ref{tab:cr-psar}).
En el repositorio\footnote{\url{https://github.com/pleonex/Ninokuni/tree/master/Programs/PS3/NinoDecompiler}} de este trabajo se incluye un programa desarrollado para su descompresión.

\ctable[
    caption = Especificación de formato PSAR,
    label   = tab:cr-psar,
    pos     = h
]{ccl}{
    \tnote[a]{\textit{File Info Table}. Tabla con información genérica de los archivos.}
    \tnote[b] {Los archivos pueden estar comprimidos.}
    \tnote[c] {El primer archivo con código MD5 nulo contiene la lista de nombres y rutas de ficheros.}
}{                                                                      \FL
    Posición      & Tamaño        & Descripción                         \ML
    \multicolumn{3}{c}{Cabecera}                                        \NN
    \textsf{0x00} & \textsf{0x04} & Identificador: \textsf{PSAR}        \NN
    \textsf{0x04} & \textsf{0x04} & Versión: \textsf{0x00010004}        \NN
    \textsf{0x08} & \textsf{0x04} & Compresión: \textsf{zlib}           \NN
    \textsf{0x0C} & \textsf{0x04} & Posición de los datos               \NN
    \textsf{0x10} & \textsf{0x04} & Tamaño del FIT\tmark[a]             \NN
    \textsf{0x14} & \textsf{0x04} & Número de archivos                  \NN
    \textsf{0x18} & \textsf{0x04} & Reservado                           \NN
    \textsf{0x1C} & \textsf{0x04} & Reservado                           \ML
    \multicolumn{3}{c}{FIT}                                             \NN
    \textsf{0x00} & \textsf{0x10} & Código MD5 del nombre del fichero   \NN
    \textsf{0x10} & \textsf{0x04} & Desconocido                         \NN
    \textsf{0x14} & \textsf{0x05} & Posición de los datos               \NN
    \textsf{0x19} & \textsf{0x05} & Tamaño de los datos                 \ML
    \multicolumn{3}{c}{Archivos\tmark[b]\tmark[c]}                      \LL
}

\includefigure{fig:cr-psar}%
{Primeros \textit{bytes} del fichero \emph{PSAR}.}%
{imgs/CR-PSAR.png}

Descomprimiendo el fichero se encuentran nueve archivos de los cuales destaca uno de 438 MB \textit{data/book/es/BigData/gdv.dat}.
Por su tamaño se intuye su contenido.
Su formato de nuevo fácil de analizar pues tras unas largas cabeceras, al inicio de los datos hay una cabecera con las siglas \emph{JPEG}.
A continuación en la figura~\ref{tab:cr-gvd} se muestra la especificación de este tipo de fichero que contiene cada una de las hojas del libro electrónico.


\ctable[
    caption = Especificación de formato GVD,
    label   = tab:cr-gvd,
]{ccl}{
    \tnote[a]{Hay un bloque por página.}
    \tnote[b]{Relativo al inicio del bloque de datos.}
    \tnote[c]{La codificación del nombre es ASCII.}
    \tnote[d]{Hay un bloque por cada calidad.}
    \tnote[e]{Los datos pueden estar comprimidos en \textsf{GVMP}, en ese
    caso el primer bloque será la imagen \textsf{JPEG}.}
}{                                                                          \FL
    Posición      & Tamaño        & Descripción                             \ML
    \multicolumn{3}{c}{Cabecera}                                            \NN
    \textsf{0x00} & \textsf{0x08} & Identificador: \textsf{TGDT0100}        \NN
    \textsf{0x08} & \textsf{0x04} & Número de páginas                       \NN
    \textsf{0x0C} & \textsf{0x04} & Posición de los datos                   \ML
    \multicolumn{3}{c}{Bloques GVD\tmark[a]}                                \NN
    \textsf{0x00} & \textsf{0x04} & Posición del nombre\tmark[b]\tmark[c]   \NN
    \textsf{0x04} & \textsf{0x04} & Tamaño del nombre                       \NN
    \textsf{0x08} & \textsf{0x04} & Posición de los datos\tmark[b]          \NN
    \textsf{0x0C} & \textsf{0x04} & Tamaño de los datos                     \ML
    \multicolumn{3}{c}{Información de la página}                            \NN
    \textsf{0x00} & \textsf{0x04} & Identificador bloque: \textsf{GVEW0100} \NN
    \textsf{0x04} & \textsf{0x04} & Identificador imagen: \textsf{JPEG0100} \NN
    \textsf{0x08} & \textsf{0x04} & Ancho de la imagen con más calidad      \NN
    \textsf{0x0C} & \textsf{0x04} & Alto de la imagen con más calidad       \NN
    \textsf{0x10} & \textsf{0x04} & Identificador: \textsf{BLK\_}           \NN
    \textsf{0x14} & \textsf{0x04} & Tamaño del bloque                       \NN
    \textsf{0x18} & \textsf{0x04} & ID                                      \NN
    \textsf{0x1C} & \textsf{0x04} & Reservado                               \NN
    \textsf{0x20} & \textsf{0x04} & Constante \textsf{0x20}                 \NN
    \textsf{0x24} & \textsf{0x04} & Constante \textsf{0x04}                 \ML
    \multicolumn{3}{c}{Datos de la página\tmark[d]}                         \NN
    \textsf{0x00} & \textsf{0x04} & Posición X de la imagen en la página    \NN
    \textsf{0x04} & \textsf{0x04} & Posición Y de la imagen en la página    \NN
    \textsf{0x08} & \textsf{0x04} & Calidad                                 \NN
    \textsf{0x0C} & \textsf{0x04} & Tamaño de los datos                     \NN
    \textsf{0x10} & \textsf{0x04} & Desconocido                             \NN
    \textsf{0x14} & \textsf{0x04} & Desconocido                             \NN
    \textsf{0x18} & \textsf{0x04} & Ancho                                   \NN
    \textsf{0x1C} & \textsf{0x04} & Alto                                    \NN
    \textsf{0x20} & Variable      & Imagen \textsf{JPEG}\tmark[e]           \ML
    \multicolumn{3}{c}{GVMP}                                                \NN
    \textsf{0x00} & \textsf{0x04} & Identificador: \textsf{GVMP}            \NN
    \textsf{0x04} & \textsf{0x04} & Número de bloques.                      \NN
    \textsf{0x08} & \textsf{0x04} & Posición de los datos del primer bloque \NN
    \textsf{0x0C} & \textsf{0x04} & Tamaño de los datos del primer bloque   \LL
}

Como se aprecia, una página se compone de diferentes imágenes \textsf{JPEG} concatenadas.
Tras este análisis, desde el primer fichero directamente extraído de la carpeta del juego en formato \textsf{PSAR} hasta este que contiene cada una de las páginas en formato \textsf{GVD} no se ha apreciado ningún mecanismo que intente proteger o dificultar la tarea de extraer cada una de las páginas.
Incluso los formatos de las propias imágenes son estándar.

Cabe destacar también, que la \acs{PS3} provee de mecanismos nativos para cifrar archivos que sí se usa para proteger el resto de datos del juego como imágenes y textos (archivo \textit{hs06\_es.adat.sdat}).
Este formatos con extensión \textsf{sdat} y cabecera \textsf{NPD} usa las claves internas y mecanismos internos de cifrado de la consola que asegura su confidencialidad\footnote{A día de hoy ya se ha podido romper este mecanismo~\cite{GH-npdata}.}.

\subsubsection{Conclusión}

\begin{tabular}{p{0.4\textwidth}p{0.5\textwidth}}
Puntos fuertes & Puntos débiles \\
% Pros
\begin{itemize}
\item El libro está codificado en un formato propietario.
\item Se requiere de nuevo \textit{software} para extraer las páginas.
\end{itemize} &

% Contras
\begin{itemize}
\item El archivo con el libro no está cifrado a pesar de que la \acl{PS3} provee de mecanismos para ello que se utiliza sobre el resto de los ficheros.
\item La codificación de las páginas es estándar (\textit{JPEG}).
\end{itemize} \\
\end{tabular}

\subsection{100 Classic Book Collection}
\label{sec:cr-100-books}
El segundo juego que se ha analizado para comprobar su seguridad en cuanto a libros electrónicos ha sido \textit{100 Classic Book Collection}.
Desarrollado por \textit{HaperCollins} en 2008 para la \textit{Nintendo DS}.
No se trata de un juego propiamente dicho, si no de una colección de libros junto a un visor, de forma que la videoconsola se convierte en un lector.
Como el nombre indica, el juego contiene entorno a 100 libros incluyendo descargables.

El formato que contiene los libros de nuevo no tiene mecanismo alguno de protección siendo incluso más sencillo que el caso anterior (table~\ref{tab:cr-100books}). De los hasta 23 bloques que contiene un libro, el primero contiene información del libro, del segundo al quinto imágenes de portada y el resto el texto del libro junto a resumen y descripción del autor (figura~\ref{fig:cr-100books}).

\ctable[
    caption = Especificación del formato de \textit{100 Classic Books},
    label   = tab:cr-100books,
    pos     = h
]{ccl}{
    \tnote[a]{Algunos bloques pueden estar vacíos.}
    \tnote[b]{Todos los bloques excepto el primero están comprimidos con \textsc{LZSS}.}
}{                                                                      \FL
    Posición      & Tamaño        & Descripción                         \ML
    \multicolumn{3}{c}{Cabecera}                                        \NN
    \textsc{0x00} & \textsc{0x10} & Desconocido                         \NN
    \textsc{0x10} & \textsc{0x04} & Desconocido                         \NN
    \textsc{0x14} & \textsc{0x04*23} & Puntero a cada uno de los bloques\NN
    \textsc{0x70} & \textsc{0x04*23} & Tamaño de cada bloque            \ML
    \multicolumn{3}{c}{Bloques\tmark[a]\tmark[b]}                       \LL
}

\includefigure{fig:cr-100books}%
{Extracto de texto de un libro de \textit{100 Classic Books}.}%
{imgs/CR-100Books.png}

Si bien es cierto que todas estas obras son clásicas, sin derechos de autor a día de hoy, el trabajo de maquetado y adaptación sí se puede cobrar.

\subsubsection{Conclusión}

\begin{tabular}{p{0.4\textwidth}p{0.5\textwidth}}
Puntos fuertes & Puntos débiles \\
% Pros
\begin{itemize}
\item No se usa un formato estándar para la representación del texto ni la estructura del libro. Se requiere por tanto de nuevos programas para extrar y editar.
\end{itemize} &

% Contras
\begin{itemize}
\item Los libros no están cifrados.
\item No hay mecanismos de integridad para proteger ante modficaciones.
\end{itemize} \\
\end{tabular}

\section{Bandas sonoras}
Las música de los videojuegos es una de sus partes más importantes.
De ahí que se llegue a vender de forma a parte siendo este el objetivo de muchas compañías\footnote{Incluso vídeos de partidas de videojuegos pueden ser censurados en Youtube por derechos de autor\cite{YT-Gameplay}.}.
Además existe el género \textit{musical} en el cual canciones recientes y con derechos de autor se pueden incluir dentro del juego.

En esta sección se pretende analizar mecanismos de seguridad sobre los archivos musicales del juego. En primer luego se analizará el género musical para pasar a ver casos donde la banda sonora se ha vendido de forma externa al juego.

\subsection{Osu! Tatakae! Ouendan!}
\textit{Osu! Tatakae! Ouendan!} se trata de un juego japonés para la \textit{Nintendo DS} que salió en 2005.
En occidente salió también una segunda versión que usaba el mismo motor un año después, \textit{Elite Beat Agents}.
Se trata de dos juegos musicales donde hay que seguir el ritmo de canciones conocidas de los años 80 y 90 con el lápiz.
Internamente los dos juegos son idénticos cambiando solo el contenido pero no la estructura.

Las canciones están comprimidas dentro del archivo de sonido estándar en \acs{NDS}: \textsf{SDAT}.
El formato, posiblemente soportado nativamente por la \acs{API} de la consola, permite almacenar sonido tanto sintetizado parecido a \acs{MIDI} como digitalizado.
Para este último se permite varias codificaciones: \acs{PCM} de 8 bits, \acs{PCM} de 16 bits y \acs{IMA-ADPCM} siendo esta la que más calidad provee y el que se usa en estos juegos (figura~\ref{fig:cr-elite}).

\includefigure{fig:cr-elite}%
{Archivos comprimidos en \textsf{SDAT} y codificados con \acs{IMA-ADPCM} visto con Tinke.}%
{imgs/CR-Elite.png}

Esto no provee ninguna protección pues no se usa ningún tipo de cifrado y se usa una codificación y formato estándar de la consola y muy estudiado.
Sin embargo, por facilidades técnicas las canciones vienen en fragmentos y la dificultad recae en saber el orden de los mismos para recomponerla.

\subsubsection{Conclusión}

\begin{tabular}{p{0.4\textwidth}p{0.5\textwidth}}
Puntos fuertes & Puntos débiles \\
% Pros
\begin{itemize}
\item Las canciones están dividas en partes de forma que no es inmediato conocer el orden exacto para reconstruir una canción.
\end{itemize} &

% Contras
\begin{itemize}
\item Los archivos no están cifrados.
\item Se usa formatos y códecs estándar.
\end{itemize} \\
\end{tabular}

\subsection{Guitar Hero: On Tour}
\textit{Guitar Hero: On Tour} es una serie de tres videojuegos para la \textit{Nintendo DS} desarrollados por \textit{Vicarius Visions} y que salieron en 2008 y 2009.
Son juegos musicales donde el jugador simula estar tocando una guitarra a la vez que escucha canciones desde los años 70 hasta la actualidad.
Se caracterizan por incluir una pieza de \textit{hardware} extra e imprescindible para el juego denominado \textit{Guitar Grip}.
Este aparato tiene los cuatro botones que la guitarra simulada que se conectan en el segundo \textit{slot} de la consola.

Gracias a incluir \textit{hardware} adicional hace que no sea posible piratear el juego~(figura~\ref{fig:cr-guitarGrip}), pues no había forma de jugar sin esta
\footnote{Más tarde se descubrió un parche\cite{GTemp-GHhack} para poder jugar usando los botones de la consola y no necesitar \textit{Guitar Grip}.}.

\includefigure{fig:cr-guitarGrip}%
{\textit{Guitar Grip} necesario para jugar a la saga \textit{Guitar Hero: On Tour}.}%
{imgs/CR-GuitarGrip.png}

Analizando el primer juego de la saga, se puede ver que todos los archivos están contenidos en los ficheros \textit{mainFIGS.gfc} y \textit{mainFIGS.gob}. Si bien la estructura del primer fichero parece sencilla: 4 bytes con el tamaño y otros 4 bytes con la posición del fichero.
Sin embargo, el archivo que contiene todos los datos está cifrado.
El código ensamblador con el algoritmo de descifrado cuenta con alrededor de 1900 líneas de instrucciones que hacen muy difícil su comprensión y que, como se comentó en el segundo capítulo, hace que el esfuerzo valga más que el contenido. En concreto, tras tardar entorno a 4 horas en analizar las primeras 200 instrucciones se desistió de la tarea. Más adelante, se pudo encontrar información al respecto del algoritmo, tratándose simplemente de una implementación de \textsf{zlib}~\cite{Ungob}.

Al ser un juego famoso, ha habido investigaciones sobre el formato de los ficheros por lo que el procedimiento de extracción de las canciones está documentado\cite{SH-GH}. La estructura de este formato se describe en la tabla~\ref{tab:cr-guitarHero}.

\ctable[
    caption = Especificación del formato de \textit{Guitar Hero: On Tour},
    label   = tab:cr-guitarHero,
    pos     = h
]{ccl}{
    \tnote[a]{Información extraída de ungob.pl~\cite{Ungob} y corroborada.}
    \tnote[b]{Los datos del fichero están codificados en \textit{big-endian}.}
    \tnote[c]{Se describe la primera entrada.}
    \tnote[d]{Si es el último bloque el valor será \textsc{0x7FFF}.}
}{                                                                          \FL
    Posición      & Tamaño        & Descripción                             \ML
    \multicolumn{3}{c}{Cabecera\tmark[a]\tmark[b]}                          \NN
    \textsc{0x00} & \textsc{0x04} & Identificador: \textsc{0x00008008}      \NN
    \textsc{0x04} & \textsc{0x04} & Tamaño del archivo \textsc{GOB}         \NN
    \textsc{0x08} & \textsc{0x04} & Número de bloques                       \NN
    \textsc{0x0C} & \textsc{0x04} & Número de archivos                      \ML
    \multicolumn{3}{c}{Tabla de bloques\tmark[c]}                           \NN
    \textsc{0x00} & \textsc{0x04} & Tamaño del bloque                       \NN
    \textsc{0x04} & \textsc{0x04} & Posición del bloque                     \NN
    \textsc{0x08} & \textsc{0x04} & Posición del siguiente bloque\tmark[d]  \NN
    \textsc{0x0C} & \textsc{0x04} & Tipo de bloque: \textsc{0x30} descomprimido, \textsc{0x7A} comprimido con \textit{zlib}                              \ML
    \multicolumn{3}{c}{Tabla desconocida\tmark[c]}                          \NN
    \textsc{0x00} & \textsc{0x04} & Desconocido                             \ML
    \multicolumn{3}{c}{Tabla de ficheros\tmark[c]}                          \NN
    \textsc{0x00} & \textsc{0x04} & CRC32 del nombre en minúscula           \NN
    \textsc{0x04} & \textsc{0x04} & Tamaño del fichero                      \NN
    \textsc{0x08} & \textsc{0x04} & Posición del primer bloque              \LL
}

Tras descomprimir este fichero se pueden ver diferentes carpetas y archivos con nombres descriptivos de su contenido. Estas carpetas coinciden en nombre y formato de ficheros con las siguientes versiones del juego que se describen a continuación. Por tanto, esta primera edición del juego provee de buenos mecanismos frente tanto a la distribución ilícita por la necesidad de  \textit{hardware} adicional además de la extracción de canciones mediante un algoritmo largo y complejo de descifrar.

Sin embargo, se encuentra un descuido en las siguientes dos ediciones del juego.
Los archivos no llegaron a ser empaquetados en formato \textsc{GFC} + \textsc{GOB} ni protegidos de ninguna manera.
Se haya dentro del juego las carpetas \textit{StrmFIGS} y \textit{TracksFIGS} (nótese la terminación \textit{FIGS} usada anteriormente para nombrar al archivo \textsc{GOB}).
Dentro se puede encontrar las canciones en formato \textsc{Vorbis OGG} estándar\cite{Xentax-HWAS}.
En concreto, por facilidades técnicas se han separado cada canción en tres archivos, uno con la base de guitarra, otra con la base de batería y otra con la voz.
Las dos primeras están codificadas en \textsc{OGG} y la tercera en \textsc{HWAS}.
Este último formato se trata de \textsc{IMA-ADPCM-Vorbis VOX} con una cabecera de 512 bytes descrita en la tabla~\ref{tab:cr-vox}.
Mezclando las tres pistas se obtiene una versión casi perfecta del audio original.

\ctable[
    caption = Especificación del formato \textit{HWAS},
    label   = tab:cr-vox,
    pos     = h
]{ccl}{

}{                                                                          \FL
    Posición      & Tamaño        & Descripción                             \ML
    \multicolumn{3}{c}{Cabecera\tmark[a]\tmark[b]}                          \NN
    \textsc{0x00} & \textsc{0x04} & Identificador: \textsc{hwas}            \NN
    \textsc{0x04} & \textsc{0x04} & Desconocido                             \NN
    \textsc{0x08} & \textsc{0x04} & Frecuencia de muestreo                  \NN
    \textsc{0x0C} & \textsc{0x04} & Número de canales                       \NN
    \textsc{0x10} & \textsc{0x04} & Reservado                               \NN
    \textsc{0x14} & \textsc{0x04} & Tamaño de los datos de audio            \NN
    \textsc{0x18} & \textsc{0x04} & Número de muestras                      \NN
    \textsc{0x1C} & \textsc{0x1E4} & Reservado                              \ML
    \multicolumn{3}{c}{Datos de audio en IMA-ADPCM}                         \LL
}

\subsubsection{Conclusión}

\begin{tabular}{p{0.4\textwidth}p{0.5\textwidth}}
Puntos fuertes & Puntos débiles \\
% Pros
\begin{itemize}
\item En la primera edición se comprimen todos los ficheros en un formato difícil de investigar.
\item Los datos están comprimidos en una compresión de 1900 instrucciones máquinas que imposibilita prácticamente su estudio.
\item El formato de algunos ficheros de audio no es estándar y no se puede obtener fácilmente una conversión completamente exacta con programas normales.
\end{itemize} &

% Contras
\begin{itemize}
\item La compresión \textit{zlib} se incluye con información de depuración innecesaria que facilita su comprensión.
\item En las dos ediciones que siguieron a la primera del juego los archivos están sin comprimir y codificar.
\item La mayoría de las canciones vienen codificadas en \textit{OGG} que estándar. Además, se da a conocer este formato mediante la extensión de los ficheros.
\end{itemize} \\
\end{tabular}

\subsection{Guitar Rock}
\textit{Guitar Rock} es un juego desarrollado por \textit{Gameloft} en el año 2008 para la \textit{Nintendo DS}.
Su jugabilidad es muy parecida a la de \textit{Guitar Hero: On Tour} diferenciándose en que no necesita \textit{hardware} como el \textit{Guitar Grip}.

De nuevo las canciones vienen sin proteger dentro del juego encontrándolas dentro de los archivos \textit{trackX.bar}.
Este formato tiene una cabecera de 512 bytes siguiéndole tres pistas musicales de la canción en formato estándar de la \textit{Nintendo DS} \textsc{SWAV}.
Mezclando estas tres pistas se obtiene la canción original sin pérdidas.

\subsubsection{Conclusión}

\begin{tabular}{p{0.4\textwidth}p{0.5\textwidth}}
Puntos fuertes & Puntos débiles \\
% Pros
\begin{itemize}
\item Los archivos vienen comprimidos en un formato no estándar por lo que no es inmediata su extracción.
\end{itemize} &

% Contras
\begin{itemize}
\item Las canciones no están cifradas y además están codificadas con códecs estándar.
\end{itemize} \\
\end{tabular}

\subsection{Level-5}
El estudio \textit{Level-5} se centra en el desarrollo de juegos para la \textit{Nintendo DS}.
Cabe destacarlo como objeto de estudio pues la banda sonora de juegos tan famosos como \textit{El Profesor Layton}, \textit{Inazuma Eleven} o \textit{Ninokuni} ha estado codificada en un formato propietario y exclusivo.

El formato \textsc{SADL} es un contenedor que admite las codificaciones \acs{IMA-ADPCM} y una desarrollada por el estudio \textit{Procyon}.
Esta última, se trata de una variante de \acs{IMA-ADPCM} con algoritmo predictivo lo que ofrece gran compresión sin pérdida de calidad apenas.

Esto permitió por ejemplo en el caso de \textit{Ninokuni} introducir en el juego una banda sonora grabada por la orquesta de Tokio.
Además, al ser propietario y único para estos juegos tanto el formato de archivo como de codificación de las muestras, dificultó la tarea de extracción y hubieron de pasar varios años hasta que se investigó.
La codificación de este formato se ha investigado y documentado en repositorios de GitHub\footnote{\url{https://github.com/pleonex/SADL-Audio-format}}.

Caso distinto es la versión para \acl{PS3} de este juego dado que el formato de los archivos es estándar y se puede reproducir con programas como \url{http://www.videolan.org/vlc/}{VLC}.
La protección en este juego se centra en el empaquetado de todos los archivos (excepto el libro electrónico) que como se describió en la primera sección viene protegida con una clave propia de la consola.

\subsubsection{Conclusión}

\begin{tabular}{p{0.4\textwidth}p{0.5\textwidth}}
Puntos fuertes & Puntos débiles \\
% Pros
\begin{itemize}
\item Se ha usado un formato y codificación nueva que requiere el desarrollo de nuevos programas.
\end{itemize} &

% Contras
\begin{itemize}
\item No se provee de cifrado u otro mecanismo de protección más allá del cambio de formato.
\end{itemize} \\
\end{tabular}

\subsection{Duet}
En último lugar se describirá el videojuego \textit{Duet}.
Desarrollado por \textit{Kumobius} para las plataformas Android y iOS en 2013.
La aplicación es de pago pero en periodos de oferta está disponible gratuitamente.

La banda sonora fue compuesta por Tim Shiel y puede comprarse en iTunes\footnote{\url{https://itunes.apple.com/us/album/duet/id721804015}} por \$4.99.
Sin embargo, al igual que pasó con los juegos anteriormente descritos, la seguridad ante una posible extracción se dejó en la capa del binario del juego.
En este caso, si se cuenta con un móvil con acceso al sistema de archivos (\textit{jailbreak} en el caso de iOS) y se accede a la carpeta de la aplicación se puede encontrar toda la banda sonara en formato \textsc{WAV}.

\subsubsection{Conclusión}

\begin{tabular}{p{0.4\textwidth}p{0.5\textwidth}}
Puntos fuertes & Puntos débiles \\
% Pros
\begin{itemize}
\item Si no se posee de un dispositivo con acceso de \textit{superusuario} no se puede acceder a los audios.
\end{itemize} &

% Contras
\begin{itemize}
\item Los ficheros vienen en formato estándar, sin cifrar y con una extensión que indica su contenido y formato.
\end{itemize} \\
\end{tabular}

\section{Vídeos}
Hoy en día y cada vez más, las videoconsolas tienen más potencia y resolución.
Tal punto es, que muchas de ellas son más potentes que los computadores de la época.
Esto ha permitido introducir escenas tanto generadas por ordenador como de anime en los videojuegos.

Si bien de nuevo está presente el problema del agujero analógico, en algunos casos se ha aprovechado la creación de una codificación propia para la consola para proteger estos contenidos.

\subsection{\acl{PS3}}
En esta consola, la protección de muchos archivos se confió en la imposibilidad de descifrar archivos con una clave que sólo se conocía por la consola como se discutió con los libros electrónicos.

El formato estándar tiene extensión \textsc{pam} y no es más que una codificación \textsc{MPEG} con una cabecera de 1000 bytes prescindible para su decodificación.
El trabajo se ha documentado en un repositorio de GitHub donde además se ha creado un programar de conversión\footnote{ \url{https://github.com/pleonex/Ninokuni/tree/master/Programs/PS3/pam2mpg}}.

\subsubsection{Conclusión}

\begin{tabular}{p{0.4\textwidth}p{0.5\textwidth}}
Puntos fuertes & Puntos débiles \\
% Pros
\begin{itemize}
\item La cabecera y extensión garantiza que no sea inmediata su extracción.
\end{itemize} &

% Contras
\begin{itemize}
\item Se ha usado una codificación estándar sin cifrado. Sin embargo se entiende en este tipo de contenido debido a los requisitos técnicos de calidad, compresión y eficiencia.
\end{itemize} \\
\end{tabular}

\subsection{\acl{NDS}}
Caso distinto es el de esta consola.
Aun con menos potencia, cinemáticas de alta calidad han sido desarrolladas.
La mayoría de juegos usa una codificación propietaria proporcionada por Nintendo y desarrollada por Mobiclip (tras la compra de Nintendo pasó a llamarse \textit{Nintendo European Research and Development}).

A día de hoy nadie ha sido capaz de estudiar la codificación debido a la complejidad de la misma.
Al estar desarrollada explícitamente para la consola y basarse en piezas específicas de \textit{hardware}, se requiere un tiempo y conocimientos que superan el valor de la misma.
La alternativa a la hora de extraer recursos de este calibre es grabar la pantalla mientras se reproduce el juego en un emulador\footnote{El emulador DeSmuME tiene esta funcionalidad implementada.}.

\subsubsection{Conclusión}

Puntos fuertes
% Pros
\begin{itemize}
\item Al usar una codificación diferente a lo conocido y única para la \acl{NDS}, a pesar de ser la usada en mayoría de los juegos, a fecha de este trabajo nadie ha conseguido crear un descodificador.
\end{itemize}
